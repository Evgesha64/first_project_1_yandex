# Переменные проекта М1

Ниже — список ключевых переменных, функций, классов и объектов, созданных в ходе работы над проектом.

---

## Константы и настройки

### Константы окружения
- `RANDOM_STATE = 42` — фиксированный seed для воспроизводимости результатов
- `DATA_DIR = Path("datasets")` — путь к папке с датасетами
- `TRAIN_PATH = DATA_DIR / "heart_train.csv"` — путь к обучающему датасету
- `TEST_PATH = DATA_DIR / "heart_test.csv"` — путь к тестовому датасету

### Настройки pandas
- `pd.set_option("display.max_columns", 200)` — максимальное количество колонок для отображения
- `pd.set_option("display.width", 140)` — ширина отображения

### Настройки matplotlib
- `plt.rcParams["figure.figsize"] = (10, 4)` — размер фигур по умолчанию

---

## Данные (DataFrames)

### Исходные данные
- `train_df` — исходный обучающий датасет (8685 строк, 28 колонок)
  - Тип: `pandas.DataFrame`
  - Содержит таргет `Heart Attack Risk (Binary)`
  - Включает колонку `Unnamed: 0` (удалена позже)

- `test_df` — исходный тестовый датасет (966 строк, 27 колонок)
  - Тип: `pandas.DataFrame`
  - Не содержит таргет
  - Включает колонку `Unnamed: 0` (удалена позже)

### Обработанные данные
- `train_processed` — обработанный обучающий датасет (8685 строк, 27 колонок)
  - Тип: `pandas.DataFrame`
  - Без колонки `Unnamed: 0`
  - Пропуски заполнены медианой
  - Таргет преобразован в `int64`
  - `Gender` закодирован числовыми значениями

- `test_processed` — обработанный тестовый датасет (966 строк, 26 колонок)
  - Тип: `pandas.DataFrame`
  - Без колонки `Unnamed: 0`
  - Пропуски заполнены медианой (вычисленной на train)
  - `Gender` закодирован числовыми значениями

---

## Переменные анализа

### Идентификация колонок
- `target_col = 'Heart Attack Risk (Binary)'` — название колонки с таргетом
- `ID_COL = 'id'` — название колонки с идентификаторами

### Списки признаков
- `numeric_features` — список числовых признаков (без `id`, `Unnamed: 0`, таргета)
  - Содержит 24 признака типа `float64` и `int64`
  
- `categorical_features` — список категориальных признаков
  - Содержит: `['Gender']`
  
- `missing_cols` — список колонок с пропусками:
  ```python
  ['Diabetes', 'Family History', 'Smoking', 'Obesity', 
   'Alcohol Consumption', 'Previous Heart Problems', 
   'Medication Use', 'Stress Level', 'Physical Activity Days Per Week']
  ```

- `numeric_missing` — числовые колонки с пропусками (все 9 из `missing_cols`)

### Результаты анализа
- `missing_pattern` — Series с количеством пропусков на строку
- `outliers_info` — словарь с информацией о выбросах по каждому признаку
  - Структура: `{col_name: {'outliers_count': int, 'outliers_pct': float, 'lower_bound': float, 'upper_bound': float}}`

- `target_corr` — Series с корреляциями признаков с таргетом
- `corr_matrix` — матрица корреляций между всеми числовыми признаками
- `high_corr_pairs` — список кортежей с парами признаков с высокой корреляцией (|r| > 0.8)
- `target_means` — DataFrame со средними значениями признаков по классам таргета

---

## Маппинги и преобразования

### Кодирование категорий
- `gender_mapping` — словарь для кодирования `Gender`:
  ```python
  {'Male': 0, 'Female': 1, '1.0': 2, '0.0': 3}
  ```

---

## Импорты библиотек

### Основные библиотеки
```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
```

### Scikit-learn (для предобработки и моделирования)
```python
from sklearn.compose import ColumnTransformer
from sklearn.impute import SimpleImputer
from sklearn.pipeline import Pipeline
from sklearn.preprocessing import StandardScaler, LabelEncoder
from sklearn.model_selection import train_test_split
```

---

## Статистика по переменным

### Количество признаков
- **Всего признаков**: 26 (без `id` и таргета)
- **Числовых**: 25
- **Категориальных**: 1 (`Gender`)

### Типы данных после обработки
- `float64`: 23 колонки
- `int64`: 4 колонки (таргет, Gender, Diet, id)

### Пропуски
- **До обработки**: 2187 в train, 279 в test
- **После обработки**: 0 в обоих датасетах

### Выбросы (IQR метод)
- `Heart rate`: 2 (0.02%)
- `Smoking`: 820 (9.44%)
- `Blood sugar`: 2134 (24.57%)
- `CK-MB`: 2134 (24.57%)
- `Troponin`: 2134 (24.57%)

---

## Артефакты и модули

### Артефакты
- `artifacts/model_pipeline.pkl` — пайплайн (препроцессинг + CatBoost)

### Скрипты и API
- `train.py` — обучение модели, сохранение пайплайна
- `infer.py` — инференс, генерация `student_predictions.csv` (колонки `id`, `prediction`, с индексом)
- `ml/data_loader.py` — загрузка/очистка/кодирование `Gender`
- `ml/predictor.py` — класс `Predictor` для инференса
- `api/main.py` — FastAPI эндпоинт `/predict`
- `test.py` (дан тестом) — проверка предсказаний против `correct_answers.csv`

### Параметры финальной модели
- CatBoostClassifier: iterations=1500, learning_rate=0.03, depth=4, l2_leaf_reg=1, class_weights=[1.0, 1.88]
- Формат `prediction`: класс 0/1

---

## Планируемые объекты (для следующих этапов)

### Пайплайны предобработки
- `preprocessing_pipeline` — sklearn Pipeline для предобработки данных
- `numeric_transformer` — трансформер для числовых признаков
- `categorical_transformer` — трансформер для категориальных признаков

### Модели
- `model` — обученная модель (CatBoost или другая)
- `best_params` — лучшие гиперпараметры модели

### Метрики
- `f1_score` — F1-score на валидации
- `roc_auc` — ROC-AUC на валидации
- `confusion_matrix` — матрица ошибок

---

*Документ обновляется по мере выполнения проекта*
